---
# Create a new VM with OS from a template CentOS7
- hosts: vmcreate
  vars:
    vc_hostname: vsphere5.esphere.local
	username: ***
	password: ***
    datacenter: Виртуальный ДЦ для непром. стендов
	esxhost: esxi-ibm2.esphere.local
	name: ans-test-dev
	vmtemplate: template-centOS7
	datastore: DS-ibm-raid5
    network: DMZ_232_Test_Dev
    vmtemplate: CentOS7-Base
    notes: IT-blablabla 172.17.***.***
	
  tasks:
    -name: Create VM from a template
     vsphere_guest:
	   validate_certs: no
       vcenter_hostname: "{{ vc_hostname }}"
       username: "{{ vcenter_user }}"
       password: "{{ vcenter_pass }}"
	   esxi:
	     datacenter: "{{ datacenter }}"
         hostname: "{{ esxhost }}"
	   guest: "{{ name }}"
	   from_template: yes
       template_src: "{{ vmtemplate }}"
	   #resource_pool: "/Resources"

#Reconfigure the CPU and Memory on the newly created VM
       vm_extra_config:
         folder: ENV_DEV
         notes: "{{ notes }}"
       vm_disk:
         disk1:
           size_gb: 10
           type: thin
           datastore: "{{ datastore }}"
       vm_hardware:
         memory_mb: 1024
         num_cpus: 2
         osid: centos64Guest
         scsi: paravirtual
	   vm_nic:
         nic1:
           type: vmxnet3
           network: "{{ network }}"
           network_type: standard
	   wait_for_ip_address: yes
       state: present
  register: deploy
