---
# Create a new VM with OS from a template CentOS7
- hosts: vmcreate
  gather_facts: false
  vars:
    vc_hostname: 'vsphere5.esphere.local'
    vc_user: 'Degtyareva.YA@esphere.local'
    vc_pass: 'R289SZ7usv'
    datacenter: 'Виртуальный ДЦ для непром. стендов'
    esxhost: 'esxi-ibm2.esphere.local'
    guest_name: 'ans-test-dev'
    vmtemplate: 'template-centOS7'
    folder: 'ENV_DEV'
    notes: 'IT-blablabla 172.17.***.***'
  tasks:
    - vsphere_guest:
         validate_certs: no
         vcenter_hostname: "{{ vc_hostname }}"
         username: "{{ vc_user }}"
         password: "{{ vc_pass }}"
         esxi:
           datacenter: "{{ datacenter }}"
           hostname: "{{ esxhost }}"
         guest: "{{ guest_name }}"
         from_template: yes
         template_src: "{{ vmtemplate }}"
         #resource_pool: "/Resources"
#Reconfigure the CPU and Memory on the newly created VM
         vm_extra_config:
           folder: "{{ folder }}"
           notes: "{{ notes }}"
         vm_disk:
           disk1:
             size_gb: "{{ disk }}"
             type: thin
             datastore: "{{ datastore }}"
         vm_hardware:
           memory_mb: "{{ memory }}"
           num_cpus: "{{ cpucount }}"
           osid: "{{ osid }}"
           scsi: paravirtual
         vm_nic:
           nic1:
             type: vmxnet3
			 network: "{{ network }}"
             network_type: standart
         wait_for_ip_address: yes
         state: powered_off
         #register: deploy
...
